<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DropTV</title>

    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#0a0a0a" />
    <link rel="apple-touch-icon" href="/icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="DropTV" />

    <!-- Fonte -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500&display=swap" rel="stylesheet" />

    <!-- Estilos -->
    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: black;
        overflow: hidden;
        font-family: 'Inter', sans-serif;
      }

      video {
        width: 100%;
        height: 100%;
        object-fit: contain;
        background: black;
      }

      #overlay {
        position: fixed;
        inset: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background: black;
        z-index: 9999;
        transition: opacity 0.8s ease;
      }

      .loggo {
        width: 220px;
        opacity: 0.85;
        filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));
      }

      /* Música */
      #dv-musiqid {
        position: fixed;
        bottom: 6%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(20, 20, 20, 0.6);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 0.8rem 1.4rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      #dv-musiqid.show {
        opacity: 1;
      }

      #dv-musiqid img {
        width: 58px;
        height: 58px;
        object-fit: cover;
        border-radius: 8px;
      }

      .trackname {
        color: white;
        font-size: 1rem;
        line-height: 1.3;
      }

      .trackname span {
        display: block;
      }

      /* Chromecast */
      #castButton {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 48px;
        height: 48px;
        border: none;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(6px);
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      #castButton:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
      }

      #castButton svg {
        width: 22px;
        height: 22px;
        fill: white;
        opacity: 0.8;
      }
    </style>

    <!-- Chromecast -->
    <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>

    <!-- HLS -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  </head>

  <body>
    <!-- Splash inicial -->
    <div id="overlay">
      <img src="droptv.svg" alt="DropTV" class="loggo" />
    </div>

    <!-- Player -->
    <video id="videoPlayer" playsinline autoplay muted></video>

    <!-- Botão Chromecast -->
    <button id="castButton" title="Enviar para Chromecast">
      <svg viewBox="0 0 24 24">
        <path d="M1,18V21H4A3,3 0 0,0 1,18M1,14V16A7,7 0 0,1 8,23H10A9,9 0 0,0 1,14M1,10V12A11,11 0 0,1 12,23H14A13,13 0 0,0 1,10M21,3H3A2,2 0 0,0 1,5V8H3V5H21V19H13V21H21A2,2 0 0,0 23,19V5A2,2 0 0,0 21,3Z" />
      </svg>
    </button>

    <!-- Música atual -->
    <div id="dv-musiqid">
      <img id="cover" src="https://placehold.co/100x100" alt="Capa" />
      <div class="trackname">
        <span id="artist">Artista</span>
        <span id="title">Faixa</span>
      </div>
    </div>

    <script>
      const video = document.getElementById("videoPlayer");
      const overlay = document.getElementById("overlay");
      const streamUrl = "https://droptv.com.br/play.m3u8";

      window.addEventListener("load", () => {
        setTimeout(() => (overlay.style.opacity = 0), 1200);
        setTimeout(() => (overlay.style.display = "none"), 2000);
      });

      function initPlayer() {
        if (Hls.isSupported()) {
          const hls = new Hls({ maxBufferLength: 10 });
          hls.loadSource(streamUrl);
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED, () => video.play().catch(() => {}));
        } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
          video.src = streamUrl;
          video.addEventListener("loadedmetadata", () => video.play());
        } else {
          console.error("HLS não suportado neste navegador.");
        }
      }

      initPlayer();

      // Chromecast
      window.__onGCastApiAvailable = function (isAvailable) {
        if (isAvailable) {
          const context = cast.framework.CastContext.getInstance();
          context.setOptions({
            receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
            autoJoinPolicy: chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED,
          });

          const castButton = document.getElementById("castButton");
          castButton.addEventListener("click", () => {
            const session = context.getCurrentSession();
            if (!session) {
              context.requestSession();
            } else {
              const mediaInfo = new chrome.cast.media.MediaInfo(streamUrl, "application/x-mpegURL");
              const request = new chrome.cast.media.LoadRequest(mediaInfo);
              session.loadMedia(request);
            }
          });
        }
      };
    </script>
  </body>
</html>
